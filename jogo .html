<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aventura Colorida no Labirinto</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(to bottom, #1e1e2f, #3a3a5c);
      overflow: hidden;
      font-family: 'Comic Sans MS', cursive, sans-serif;
    }
    canvas {
      display: block;
      margin: auto;
      background: #222;
      border: 6px solid #f0f;
      box-shadow: 0 0 40px #ff00ff88;
      image-rendering: pixelated;
      border-radius: 20px;
    }
  </style>
</head>
<body>
<canvas id="game" width="800" height="600"></canvas>
<script>
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");
  const tileSize = 40;
  const cols = canvas.width / tileSize;
  const rows = canvas.height / tileSize;

  let map = [];
  let player = { x: 1, y: 1 };
  let level = 1;

  const sprites = {
    '#': ['#444', '#666'],
    '.': ['#77f', '#55d'],
    '~': ['#00f', '#00a'],
    '^': ['#f00', '#a00'],
    '*': ['#ff0', '#cc0'],
    '@': ['#f5a', '#d14'],
    'K': ['#ff0', '#ffd700'],
    'P': ['#0f0', '#4f4'],
    'B': ['#964B00', '#6b3e26'],
    'T': ['#0c0', '#090'],
    'C': ['#0ff', '#0cc'],
    'S': ['#00f', '#339'],
    'D': ['#800', '#a22'],
    '!': ['#fff', '#ccc']
  };

  function randomTile() {
    const keys = Object.keys(sprites);
    return keys[Math.floor(Math.random() * keys.length)];
  }

  function generateMaze() {
    map = [];
    for (let y = 0; y < rows; y++) {
      let row = "";
      for (let x = 0; x < cols; x++) {
        if (x === 0 || y === 0 || x === cols - 1 || y === rows - 1) {
          row += '#';
        } else {
          row += Math.random() < 0.3 ? '#' : '.';
        }
      }
      map.push(row);
    }

    map[1] = map[1].substring(0, 1) + '.' + map[1].substring(2);
    map[rows - 2] = map[rows - 2].substring(0, cols - 2) + '.' + map[rows - 2].substring(cols - 1);
  }

  function drawTile(x, y, tile) {
    const colors = sprites[tile] || ['#000'];
    const grad = ctx.createLinearGradient(x, y, x + tileSize, y + tileSize);
    grad.addColorStop(0, colors[0]);
    grad.addColorStop(1, colors[1] || colors[0]);
    ctx.fillStyle = grad;
    ctx.fillRect(x, y, tileSize, tileSize);

    if (tile === 'K') drawIcon(x, y, '🔑');
    if (tile === 'P') drawIcon(x, y, '🧪');
    if (tile === 'B') drawIcon(x, y, '📦');
    if (tile === 'T') drawIcon(x, y, '🌳');
    if (tile === 'C') drawIcon(x, y, '💎');
    if (tile === 'S') drawIcon(x, y, '🛡️');
    if (tile === 'D') drawIcon(x, y, '🚪');
    if (tile === '!') drawIcon(x, y, '🏁');
    if (tile === '@') drawIcon(x, y, '👾');
  }

  function drawIcon(x, y, emoji) {
    ctx.font = "24px Arial";
    ctx.fillText(emoji, x + 8, y + 28);
  }

  function drawPlayer() {
    const px = player.x * tileSize;
    const py = player.y * tileSize;
    ctx.fillStyle = '#ffd700';
    ctx.fillRect(px + 5, py + 5, tileSize - 10, tileSize - 10);
    ctx.font = "26px Arial";
    ctx.fillText('😎', px + 5, py + 30);
  }

  function drawMap() {
    for (let y = 0; y < rows; y++) {
      for (let x = 0; x < cols; x++) {
        drawTile(x * tileSize, y * tileSize, map[y][x]);
      }
    }
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawMap();
    drawPlayer();
  }

  document.addEventListener("keydown", (e) => {
    let dx = 0, dy = 0;
    if (e.key === "ArrowUp") dy = -1;
    else if (e.key === "ArrowDown") dy = 1;
    else if (e.key === "ArrowLeft") dx = -1;
    else if (e.key === "ArrowRight") dx = 1;

    const newX = player.x + dx;
    const newY = player.y + dy;
    const tile = map[newY][newX];
    if (tile && tile !== '#') {
      player.x = newX;
      player.y = newY;
      if (tile === '!') {
        level++;
        alert(`Você completou a fase ${level - 1}! Prepare-se para a fase ${level}! 🎉`);
        generateMaze();
      }
    }
    draw();
  });

  setInterval(() => {
    if (Math.random() < 0.1) {
      const rx = Math.floor(Math.random() * (cols - 2)) + 1;
      const ry = Math.floor(Math.random() * (rows - 2)) + 1;
      const randomItems = ['K','P','C','@','S','T','B'];
      const item = randomItems[Math.floor(Math.random() * randomItems.length)];
      map[ry] = map[ry].substring(0, rx) + item + map[ry].substring(rx + 1);
    }
    draw();
  }, 1500);

  generateMaze();
  draw();
</script>
</body>
</html>
